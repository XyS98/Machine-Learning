<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title></title>
<link th:href="@{/layui1/css/layui.css}" rel="stylesheet" />
</head>

<body class="layui-layout-body">
<form class="layui-form" action="" lay-filter="formTaskDetail">
  <div class="layui-form-item">
    <label class="layui-form-label">雇主：</label>
    <div class="layui-input-inline">
      <input type="text" name="nickName" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">工作类型：</label>
    <div class="layui-input-inline">
      <input type="text" name="winame" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label">简介：</label>
    <div class="layui-input-block">
      <input type="text" name="title" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
    </div>
  </div>
  <div class="layui-form-item">
    <label class="layui-form-label"></label>
    <div class="layui-input-block" id="timeList">
    	<div class="layui-input-inline" style="width: 100px;">
      		<input type="text" name="releaseTime"  id = "releaseTime" placeholder="" autocomplete="off" class="layui-input">
    	</div>
    	<div class="layui-form-mid">></div>
	    <div class="layui-input-inline" style="width: 100px;">
	        <input type="text" name="bidTime" id = "bidTime" placeholder="" autocomplete="off" class="layui-input">
	    </div>
    	<div class="layui-form-mid">></div>
	    <div class="layui-input-inline" style="width: 100px;">
	        <input type="text" name="selectTime" id = "selectTime" placeholder="" autocomplete="off" class="layui-input">
	    </div>
    	<div class="layui-form-mid">></div>
	    <div class="layui-input-inline" style="width: 100px;">
	        <input type="text" name="paingTime" id = "paingTime" placeholder="" autocomplete="off" class="layui-input">
	    </div>
    	<div class="layui-form-mid">></div>
	    <div class="layui-input-inline" style="width: 100px;">
	        <input type="text" name="workTime" id = "workTime" placeholder="" autocomplete="off" class="layui-input">
	    </div>
    	<div class="layui-form-mid">></div>
    	 <div class="layui-input-inline" style="width: 100px;">
	        <input type="text" name="checkTime" id = "checkTime" placeholder="" autocomplete="off" class="layui-input">
	    </div>
    </div>
  </div>
  
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">任务详情：</label>
    <div class="layui-input-block">
      <textarea name="descr" id="descr" placeholder="" class="layui-textarea"></textarea>
    </div>
  </div>
  
  <div class="layui-form-item layui-form-text">
  <label class="layui-form-label">图片：</label>
    <div class="layui-carousel" id="img">
  <div carousel-item>
    <div>条目1</div>
    <div>条目2</div>
    <div>条目3</div>
    <div>条目4</div>
    <div>条目5</div>
  </div>
</div>
<!-- 条目中可以是任意内容，如：<img src=""> -->
  </div>
  
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label">附件：</label>
    <div class="layui-input-block">
      <a href="javascript:exportFile();" class="layui-icon layui-icon-download-circle " style="font-size: 30px; color: #1E9FFF;"></a>
    </div>
  </div>
  
  <div class="layui-form-item">
    <div class="layui-input-block">
      <button class="layui-btn" id="pass" lay-submit lay-filter="pass">通过</button>
      <button class="layui-btn" id="nopass" lay-submit lay-filter="nopass">驳回</button>
    </div>
  </div>
</form>
<script>
//Demo
layui.use('form', function(){
 $("#pass").hide();
 $("#nopass").hide();
 var layer = layui.layer;
  var form = layui.form;
  var tno = getCookie("item1");
  var status = getCookie("item2");	
  if (status == 2) {
	  $("#pass").show(); 
	  $("#nopass").show(); 
  }
	//在当前局域下下取消jquary的异步性，不然。。。 一些参数会因为异步而取不到
	$.ajaxSetup({  
	    async : false //取消异步  
	}); 
	
	$.post("/task/findList",{tno:tno},function(data){
		  console.info(data.releaseTime);
		  $("#releaseTime").val(data.releaseTime);
		  $("#bidTime").val(data.bidTime);
		  $("#selectTime").val(data.selectTime);
		  $("#paingTime").val(data.paingTime);
		  $("#workTime").val(data.workTime);
		  $("#checkTime").val(data.checkTime);
	  },"json");
	  
	  $('input:text').attr("readonly","readonly");//设为只读
	  $('#descr').attr("readonly","readonly");//设为只读
	  //监听提交
	form.on('submit(pass)', function(data){
    	layer.msg(JSON.stringify(data.field));
    
	    $.post("/task/pass",{tno:tno},function(data){
	    	var data = parseInt($.trim(data));
	    	if (data < 0 ) {
	    		layer.alert('失败');
	    	} else {
	    		layer.alert('成功');
	    	}
	  });
	    return false;
  });
	form.on('submit(nopass)', function(data){
    	layer.msg(JSON.stringify(data.field));
    
	    $.post("/task/nopass",{tno:tno},function(data){
	    	var data = parseInt($.trim(data));
	    	if (data < 0 ) {
	    		layer.alert('失败');
	    	} else {
	    		layer.alert('成功');
	    	}
	  });
	    return false;
  });
	    
	  
  $.post("/task/findOne",{tno:tno},function(data){
	  form.val("formTaskDetail", {
		  "nickName": data.nickName
		  ,"winame": data.winame
		  ,"title": data.title
		  ,"descr": data.descr
		  
		  });
  },"json");
  
  var carousel = layui.carousel;
  //建造实例
  carousel.render({
    elem: '#img'
    ,width: '100%' //设置容器宽度
    ,arrow: 'always' //始终显示箭头
    ,anim: 'fade' //切换动画方式
    ,autoplay: "false"
  });
  
  carousel.on('change(img)', function(obj){ //test1来源于对应HTML容器的 lay-filter="test1" 属性值
	  console.log(obj.index); //当前条目的索引
	  console.log(obj.prevIndex); //上一个条目的索引
	  console.log(obj.item); //当前条目的元素对象
	});     
});

function exportFile(){     
    var form=$("<form>"); // 动态的创建form表达来想服务端提交参数    
    filePath = "fdfd";
    var inputFileName=$("<input type='text' name = 'pFileName' value='"+filePath+"' />");
	//创建要提交的参数
	var fileName=$("#fileName").val();
    inputFileName.attr("value", fileName);
	//注入参数到表单
    form.append(inputFileName);
	
    form.attr("style","display:none");
    form.attr("target","");
    form.attr("method","post");//提交方式为post
    form.attr("action","/downloadFile");//定义action
    
    $("body").append(form);
    form.submit();        
}
</script>
</body>
</html>