<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hpt.mapper.ITaskMapper">
    <select id="findcount" resultType="int"  >
       select count(tl.tno)  from task ta,timeList tl,worksItem wi where wi.wino = ta.wino and tl.tno = ta.tno
        and ta.ischecked = #{ischecked}
        
    

    
    </select>
    
     <!-- 用了MySQL的一个有趣的东西来给查询（包括条件查询出来的data）一个完整的编号
     例子 select (@id:= @id + 1) as id from (select @id := 0) b
    相当于建造了一个暂时的有一个自增的id的 b 表  
    然后用parameter 里的类来 放 （页数-1）*每页数据数，和页数*每页数据数来实现分页查询
    -->
     <select id="finds" resultType="Task" parameterType="Task" >
           select id, tno, winame, releaseTime, checkTime,title   from(
    select (@id:= @id + 1) as id,tno, winame, releaseTime, checkTime,title from (select @id := 0) b,
(select tl.tno, winame, releaseTime, checkTime,title  from task ta,timeList tl,worksItem wi where wi.wino = ta.wino and tl.tno = ta.tno
        and ta.ischecked = #{ischecked}
        
   
) tab) tab1
            where (id between #{mno} and #{empno}) 
    </select>
    
    <select id="findOne" resultType="Task" parameterType="Task">
    	select me.nickName,ta.tno,wi.winame,ta.picloc,ta.docloc,ta.title,ta.descr,ta.tasktype,ta.price,ta.taskweight 
    	from task ta ,memberinfo me,worksitem wi where ta.mno = me.mno and ta.wino = wi.wino and ta.tno = #{tno} 
    </select>
    
    <select id="findList" resultType="TimeList" parameterType="TimeList">
    	select tlno,tno,releaseTime,bidTime,selectTime,paingTime,workTime,checkTime from timelist where tno = #{tno} 
    </select>
    
    <update id="setList" parameterType="TimeList" >
    		update  timelist set  releaseTime= now()
 where tno = #{tno};
    </update>
    <update id="nopass" parameterType="Task" >
    	update task set ischecked = 3 where tno = #{tno};
    </update>
    <update id="pass" parameterType="Task" >
   		 update task set ischecked = 4 where tno = #{tno};
    </update>
</mapper>